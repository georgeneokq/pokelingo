# Save/Load game

This document explains about the GameSaver class used to save and load game state data.

## How it works internally

The GameSaver class uses the Java binary serialization library [Kryo](https://github.com/EsotericSoftware/kryo) to serialize objects.

It saves data by storing mappings of names to objects. The mappings are implemented using Java's Map interface,
and each save file is a Map object serialized by Kryo.

It also provides a simple interface to handle new creation/overwriting of save data.

Save files are saved in `assets/internal/saves` and are simply named using numbers,
which also serve as the identifiers for the save data.

Some metadata are saved along with the game data, and are prefixed with underscores for differentiation purposes.
Currently saves the following metadata:
- _id
- _timestamp

## Saving

Kryo is a powerful library that can serialize any POJOs with extra configuration, which makes it to serialize data.

Avoid serializing complex objects, such as objects that inherit from other classes, or objects which contain non-primitive
data.

An example would be a Car object which extends from LibGDX's Actor class.
Instead of attempting to serialize the entire Car object,
extract the primitive data you require one by one.

Consider the following block of code:

```Java
Vector2 position = new Vector2(car.getX(), car.getY());

// For Kryo to know what classes to deserialize into
Map<String, Class> nameClassMapping = new HashMap<>();
nameClassMapping.put("position", Vector2.class);
nameClassMapping.put("score", int.class);

// Prepare a mapping of objects to be saved
Map<String, Object> saveObjects = new HashMap<>();
saveObjects.put("position", position);
saveObjects.put("score", score);

GameSaver gameSaver = new GameSaver(nameClassMapping);
int saveIdentifier = gameSaver.save(NEW_SAVE, saveObjects);
```

The above code demonstrates:

- Requried mapping of data name to its class
- Required mapping of data name to its value
- Serialization of POJO (Vector2 object)
- Serialization of primitive (int)

## Loading

Loading data should be done with the same instance, if not a duplicate,
of the GameSaver class used for saving data.
Currently, all classes should be using the GameSaver object stored in the
[Globals](/core/src/main/java/com/georgeneokq/game/Globals.java) singleton class.

A game screen that handles loading data must implement the LoadRequestReceiver interface,
which the save data selection screen will use to notify the screen of the load request.

The game screen should then handle the load request in the onLoadRequestReceived method,
where the screen can load the save data using the selected save identifier.

Save data can be loaded from the SelectSaveScreen screen.

## Testing

There are sample save data that work with the ExampleScreen located in the test resources folder, generated by the [SampleDataGenerator](/core/src/test/java/com/georgeneokq/game/tests/save/GameSaverTest.java) test class.